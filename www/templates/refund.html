{% extends '__base__.html' %}

{% block title %}退票{% endblock %}

{% block beforehead %}

    <script xmlns: xmlns: xmlns: xmlns: xmlns: xmlns: xmlns: xmlns:>
    </script>

    <script>


        function refresh2(r) {
            console.log(r)
            for (var i = 0; i < r.length; i++) {
                var tr = document.createElement('tr');

                var td_BusID = document.createElement('td')
                var td_BusFrom = document.createElement('td')
                var td_BusTo = document.createElement('td')
                var td_BusDate = document.createElement('td')
                var td_BusEnd = document.createElement('td')
                var td_TicketNum = document.createElement('td')
                var td_Price = document.createElement('td')
                var td_Order = document.createElement('td');


                td_BusID.innerHTML = r[i].BusID;
                td_BusFrom.innerHTML = r[i].BusFrom;
                td_BusTo.innerHTML = r[i].BusTo;
                td_BusDate.innerHTML = r[i].BusDate;
                td_BusEnd.innerHTML = r[i].BusEnd;
                td_TicketNum.innerHTML = r[i].TicketNum;
                td_Price.innerHTML = r[i].Price;
                td_Order.innerHTML = "<input type='button' id='sub' value='预定' onclick = 'javascript : make_order(this)'/>";

                tr.appendChild(td_BusID);
                tr.appendChild(td_BusFrom);
                tr.appendChild(td_BusTo);
                tr.appendChild(td_BusDate);
                tr.appendChild(td_BusEnd);
                tr.appendChild(td_TicketNum);
                tr.appendChild(td_Price);
                tr.appendChild(td_Order);


                var tbody = document.getElementById('tbody');
                tbody.appendChild(tr);
            }
        }

        function make_order(obj) {
            var tr1 = obj.parentNode.parentNode;
            var params = {
                "UserID":{{ __user__.UserID }},
                "BusID": tr1.cells[0].innerHTML,
                "OrderDate":123,
                "BusDate": tr1.cells[3].innerHTML,
            }

            $.ajax({
                url: '/api/add_order',
                method:'post',
                data: params,
                complete: function (data) {
                    console.log(data)
                },
                success:function (data) {
                    alert('购票成功，购票数量x1，您的订单号为：'+data.OrderID)
                    console.log(data)
                }}
            );

        }
    </script>
{% endblock %}

{% block content %}


    <table id="tickets">
        <thead>
        <tr>
            <th scope="col">订单号</th>
            <th scope="col">列车号</th>
            <th scope="col">始发站</th>
            <th scope="col">终点站</th>
            <th scope="col">发车日期</th>
            <th scope="col">到达日期</th>

            <th scope="col" onclick="">退票</th>
        </tr>
        </thead>
        <tbody id="tbody">
            <tr>{% for order in orders %}</tr>
                <td>order.OrderID</td>
                <td>order.BusID</td>
                <td>order.BusFrom</td>
                <td>order.BusTo</td>
                <td>order.BusDate</td>
                <td>order.BusEnd</td>
                {% endfor %}
        </tbody>
    </table>


    <style class="text/css">

        #tickets {
            font-family: "Lucida Sans Unicode", "Lucida Grande", Sans-Serif;
            font-size: 13px;
            text-align: center;
            margin: 45px;
            width: 1000px;
            border-collapse: collapse;
        }

        #tickets th {
            font-size: 13px;
            font-weight: normal;
            text-align: center;
            padding: 8px;
            background: #b9c9fe;
            border-top: 4px solid #aabcfe;
            border-bottom: 1px solid #fff;
            color: #039;
        }

        #tickets td {
            padding: 8px;
            background: #e8edff;
            border-bottom: 1px solid #fff;
            text-align: center;
            color: #669;
            border-top: 1px solid transparent;
        }

        #tickets tr:hover td {
            background: #d0dafd;
            color: #339;
        }
    </style>



{% endblock %}